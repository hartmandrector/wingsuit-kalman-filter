<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/wingsuit.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FlySight Plotter</title>
  </head>
  <body>
    <input type="file" id="file-input" accept=".csv" style="display: none;">
    <div id="app">
      <h1>FlySight Plotter</h1>
      <div id="drop-zone">
        <p>Drop a CSV file here or click to select</p>
      </div>
    </div>
    
    <!-- Controls panel -->
    <div id="controls-panel" style="display: none;">
      <!-- This is now integrated into the layout above -->
    </div>
    
    <canvas id="plot-canvas" width="800" height="600" style="display: none;"></canvas>
    
    <!-- Quad view containers -->
    <div id="quad-view-container">
      <div id="left-column">
        <div id="top-view-container">
          <h3>Top-Down View (East vs North)</h3>
          <canvas id="top-canvas" width="800" height="600"></canvas>
        </div>
        <div id="profile-view-container">
          <h3>Profile View (Horizontal Distance vs Altitude)</h3>
          <canvas id="profile-canvas" width="800" height="600"></canvas>
        </div>
      </div>
      <div id="middle-column">
        <div id="polar-view-container">
          <h3>Speed Components (Horizontal vs Vertical)</h3>
          <canvas id="polar-canvas" width="800" height="600"></canvas>
        </div>
        <div id="speed-comparison-view-container">
          <h3>Speed Comparison Chart</h3>
          <div id="speed-selector-container">
            <label for="speed-component-selector">Component:</label>
            <select id="speed-component-selector">
              <option value="vn" selected>VN (North Velocity)</option>
              <option value="ve">VE (East Velocity)</option>
              <option value="vd">VD (Down Velocity)</option>
              <option value="an">AN (North Acceleration)</option>
              <option value="ae">AE (East Acceleration)</option>
              <option value="ad">AD (Down Acceleration)</option>
              <option value="roll">Roll (Angle)</option>
            </select>
          </div>
          <canvas id="speed-comparison-canvas" width="800" height="600"></canvas>
        </div>
      </div>
      <div id="right-column">
        <!-- Controls panel integrated into layout -->
        <div id="controls-panel">
          <!-- Filter Type Switcher -->
          <div id="filter-type-control">
            <label>Filter Type:</label>
            <div id="filter-switch">
              <input type="radio" id="motion-estimator" name="filter-type" value="motionestimator" checked>
              <label for="motion-estimator">Motion Estimator</label>
              <input type="radio" id="kalman-filter" name="filter-type" value="kalman">
              <label for="kalman-filter">Kalman Filter</label>
            </div>
          </div>

          <!-- Calculation Method Switcher -->
          <div id="calculation-method-control">
            <label>Calculation Method:</label>
            <div id="calculation-method-switch">
              <input type="radio" id="trapezoidal-method" name="calculation-method" value="trapezoidal" checked>
              <label for="trapezoidal-method">Trapezoidal</label>
              <input type="radio" id="standard-method" name="calculation-method" value="standard">
              <label for="standard-method">Standard</label>
            </div>
          </div>

          <!-- Motion Estimator Controls -->
          <div id="motion-estimator-controls">
            <div id="alpha-control">
              <label for="alpha-slider">Alpha (Position): <span id="alpha-value">0.90</span></label>
              <input type="range" id="alpha-slider" min="0.01" max="1" step="0.01" value="0.9">
            </div>
            <div id="alpha-velocity-control">
              <label for="alpha-velocity-slider">Alpha (Velocity): <span id="alpha-velocity-value">0.90</span></label>
              <input type="range" id="alpha-velocity-slider" min="0.01" max="1" step="0.01" value="0.9">
            </div>
            <div id="alpha-acceleration-control">
              <label for="alpha-acceleration-slider">Alpha (Acceleration): <span id="alpha-acceleration-value">0.90</span></label>
              <input type="range" id="alpha-acceleration-slider" min="0.01" max="1" step="0.01" value="0.9">
            </div>
          </div>

          <!-- Kalman Filter Controls -->
          <div id="kalman-filter-controls" style="display: none;">
            <h4>Process Noise (Q Matrix)</h4>
            <div id="kalman-q-position-control">
              <label for="kalman-q-position-slider">Position: <span id="kalman-q-position-value">0.10</span></label>
              <input type="range" id="kalman-q-position-slider" min="0" max="1" step="0.01" value="0.32">
            </div>
            <div id="kalman-q-velocity-control">
              <label for="kalman-q-velocity-slider">Velocity: <span id="kalman-q-velocity-value">2.00</span></label>
              <input type="range" id="kalman-q-velocity-slider" min="0" max="1" step="0.01" value="0.57">
            </div>
            <div id="kalman-q-acceleration-control">
              <label for="kalman-q-acceleration-slider">Acceleration: <span id="kalman-q-acceleration-value">10.00</span></label>
              <input type="range" id="kalman-q-acceleration-slider" min="0" max="1" step="0.01" value="0.14">
            </div>
            
            <h4>Measurement Noise (R Matrix)</h4>
            <div id="kalman-r-position-control">
              <label for="kalman-r-position-slider">Position Offset: <span id="kalman-r-position-value">25.00</span></label>
              <input type="range" id="kalman-r-position-slider" min="-1" max="1" step="0.01" value="1.0">
            </div>
            <div id="kalman-r-velocity-control">
              <label for="kalman-r-velocity-slider">Velocity Offset: <span id="kalman-r-velocity-value">0.64</span></label>
              <input type="range" id="kalman-r-velocity-slider" min="-1" max="1" step="0.01" value="0.40">
            </div>
          </div>

          <!-- Download Controls -->
          <div id="download-controls">
            <button id="download-csv-btn" type="button">Download CSV</button>
          </div>

          <div id="point-info">
            <div id="point-details"></div>
          </div>
        </div>
      </div>
    </div>
    
    <div id="drag-overlay">
      <p>Drop new CSV file to replace</p>
    </div>
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
